@page "/"

<PageTitle>Index</PageTitle>

<h1>Hello, world!</h1>

Welcome to your new app.

<SurveyPrompt Title="How is Blazor working for you?" />

@foreach(var v in list)
{
    cnt += 1;
    
    <span>@v</span>
    <br />
    if (cnt == 10)
    {
        Console.WriteLine("adding button");
        <button type="submit" id="@cnt" @onclick="ShowDialog">Show Dialog</button>
        <br />
    }
}

@if(list.Count == 0)
{
 <button type="submit" @onclick="StateHasChanged">Generate Long List</button>
}
 <br/>
  <br/>
 <button type="submit" @onclick="ShowDialog">Show Dialog</button>
  <br/>
 <span>@message</span>

@code{
    int cnt =0;
    List<string> list = new List<string>();
    private bool IsVisible { get; set; } = true;

    [CascadingParameter] 
    public IModalService Modal { get; set; }

    string message = "";
    ModalOptions options = new ModalOptions
        {
            HideCloseButton = true,
            DisableBackgroundCancel = true,
            HideHeader = true

        };
    protected async override Task OnAfterRenderAsync(bool firstRender)
    {
        if(firstRender)
        {
            for (int i = 0; i < 50; i++)
            {
                list.Add("This is item " + i.ToString());
            }
        }

        await  base.OnAfterRenderAsync(firstRender);

        return;
    }

    private async Task ShowDialog()
    {
        cnt = 0;
        var modalRef = Modal?.Show<LoadingSpinner>(string.Empty, options);
            try
            {
                          
                message = "";
              
               await Task.Delay(4000);
                message = "completed";
                StateHasChanged();
             
            }
            catch (Exception)
            {

                throw;
            }
            finally
            {
                if(modalRef != null)
                    modalRef.Close();
            }
        }
}